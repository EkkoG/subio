log_level = "DEBUG"

[options]
work_filter = '.*(香港|Hong Kong|HK|Japan|美国|United States|US).*(?<!\.)(1|2|3|4)|work|home-trojan-v6|ekko.*|dler.*'
[filters]
# 过滤使用原始名称匹配（重命名前的名称）
# 例如：原始名称 "剩余流量: 100GB" 被重命名为 "备用机场-剩余流量: 100GB"
#       exclude 仍然匹配原始名称 "剩余流量: 100GB"
exclude = '.*剩余流量|距离下次|套餐到期.*'
# include = '.*'

[[uploader]]
name = 'gist'
type = 'gist'
# https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token
token = "ENV_GITHUB_TOKEN"
id = "a188d6b32ddf7cf3bbc9554055e5e2a4"

[[provider]]
name = "主力机场"
type = "clash-meta"
file = "meta.yaml"
# url = 'https://github.com/MetaCubeX/mihomo/raw/refs/heads/Alpha/docs/config.yaml'

[[provider]]
name = "Surge 测试本地"
type = "surge"
file = 'surge.conf'
[provider.rename]
add_prefix = "Surge-"

[[provider]]
name = "v2rayn"
type = "v2rayn"
file = 'v2rayn.txt'

[[provider]]
name = "Surge 测试"
type = "surge"
url = "https://gist.github.com/EkkoG/623bfd3be62a68b831c29007305ebbc2/raw/surge.conf"
[provider.rename]
add_prefix = "备用机场-"
replace = [
  {old = "节点", new = "机场"}
]

[[provider]]
name = "自建节点"
type = "subio"
file = 'self.toml'

[[provider]]
name = "自建节点-隐私"
type = "subio"
file = 'self.toml'
privacy_endpoint = 'ss1'

[[provider]]
name = "JSON5节点"
type = "subio"
file = 'nodes.json5'

# ============ Dialer Proxy 示例 ============
# Dialer Proxy 示例: 将某个 provider 中的所有节点都通过另一个代理连接
# 适用于需要代理链的场景，例如：节点 -> 代理A -> 代理B -> 目标服务器
# 
# 在 Clash/Clash Meta/Stash 中输出为 dialer-proxy 参数
# 在 Surge 中输出为 underlying-proxy 参数
# 
# 注意：dialer_proxy 的值应该是另一个已定义的代理名称（需要在同一个 artifact 的 providers 中定义）

# 示例1: Clash Meta 中使用 dialer-proxy
# 将"主力机场"的所有节点通过"自建节点"中的某个节点连接
# dialer_proxy 的值必须是同一个 artifact 中已存在的节点名称
[[provider]]
name = "主力机场-代理链"
type = "clash-meta"
file = "meta.yaml"
dialer_proxy = "香港-IPLC-01"  # 该 provider 中的所有节点都会添加 dialer-proxy=香港-IPLC-01（Clash）或 underlying-proxy=香港-IPLC-01（Surge）
[provider.rename]
add_prefix = "代理链-"

# 示例2: Surge 中使用 dialer-proxy（会自动转换为 underlying-proxy）
# dialer_proxy 的值必须是同一个 artifact 中已存在的节点名称
[[provider]]
name = "Surge 测试-代理链"
type = "surge"
file = 'surge.conf'
dialer_proxy = "Surge-ss1"  # 该 provider 中的所有节点都会添加 underlying-proxy=Surge-ss1
[provider.rename]
add_prefix = "代理链-"

[[artifact]]
name = "ekko-meta.yaml"
type = "clash-meta"
template = "clash.yaml"
providers = ["自建节点-隐私", "自建节点", "主力机场", "Surge 测试"]
[artifact.options]
work = true

[[artifact]]
name = "ekko2.yaml"
type = "clash"
template = "clash.yaml"
providers = ["自建节点", "主力机场"]
[artifact.options]
work = true

[[artifact]]
name = "ekko-stash.yaml"
type = "stash"
template = "clash.yaml"
providers = ["自建节点", "主力机场"]
[artifact.options]
work = true

[[artifact]]
name = "ekko-surge.conf"
type = "surge"
template = "surge.conf"
providers = ["自建节点", "主力机场", "Surge 测试", 'Surge 测试本地']
[artifact.options]
work = true
[[artifact.upload]]
to = "gist"
[[artifact.upload]]
to = "gist"
file_name = 'clash-for-xx.yml'

# [[artifact]]
# name = "dae.conf"
# type = "dae"
# template = "dae.conf"
# providers = ["自建节点", "主力机场", "Surge 测试", 'Surge 测试本地']
# [artifact.options]
# work = true

# [[artifact]]
# name = "dae_subscription.txt"
# type = "dae"
# template = "dae_subscription.txt"
# providers = ["自建节点", "主力机场", "Surge 测试", 'Surge 测试本地']
# [artifact.options]
# work = true
# [[artifact.upload]]
# to = "gist"

[[artifact]]
name = "v2rayn.conf"
type = "v2rayn"
template = "v2rayn.conf"
providers = ["v2rayn"]

# ============ Dialer Proxy 测试示例 ============
# 测试 dialer-proxy 功能：生成带代理链的配置
[[artifact]]
name = "test-dialer-proxy.yaml"
type = "clash-meta"
template = "clash.yaml"
providers = ["自建节点", "主力机场-代理链"]
[artifact.options]
work = false

# 测试 Surge underlying-proxy 功能
[[artifact]]
name = "test-underlying-proxy.conf"
type = "surge"
template = "surge.conf"
providers = ["Surge 测试本地", "Surge 测试-代理链"]
[artifact.options]
work = false

# ============ 多用户示例 ============
# Multi-user example: 一个配置为多个用户批量生成

[[provider]]
name = "多用户节点"
type = "subio"
file = 'multiuser.yml'

# 方式1: 批量生成多用户配置
# 会生成: clash-for-alice.yml, clash-for-bob.yml, clash-for-charlie.yml
[[artifact]]
name = "clash-for-{user}.yml"
type = "clash"
template = "clash.yaml"
providers = ["多用户节点", "自建节点"]
users = ["alice", "bob", "charlie"]
[artifact.options]
work = false
[[artifact.upload]]
to = "gist"
file_name = "clash-for-{user}.yml"

# 方式2: 单用户配置 (混合多用户节点 + 自建节点 + 机场节点)
[[artifact]]
name = "clash-alice-full.yml"
type = "clash"
template = "clash.yaml"
providers = ["多用户节点", "自建节点", "JSON5节点", "主力机场"]
user = "alice"
[artifact.options]
work = true

[[ruleset]]
name = 'netflix'
url = 'https://github.com/blackmatrix7/ios_rule_script/raw/master/rule/Surge/Netflix/Netflix.list'
[[ruleset]]
name = 'apple_direct'
url = 'https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/ruleset/apple.txt'